"use strict";(self.webpackChunkcredo_ts_docs=self.webpackChunkcredo_ts_docs||[]).push([[6266],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var i=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)a=o[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=i.createContext({}),d=function(e){var t=i.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},u=function(e){var t=d(e.components);return i.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=d(a),c=n,h=p["".concat(l,".").concat(c)]||p[c]||m[c]||o;return a?i.createElement(h,r(r({ref:t},u),{},{components:a})):i.createElement(h,r({ref:t},u))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,r=new Array(o);r[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:n,r[1]=s;for(var d=2;d<o;d++)r[d]=a[d];return i.createElement.apply(null,r)}return i.createElement.apply(null,a)}c.displayName="MDXCreateElement"},37147:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var i=a(87462),n=(a(67294),a(3905));const o={},r="Mediation",s={unversionedId:"tutorials/mediation",id:"tutorials/mediation",title:"Mediation",description:"This section assumes that you have:",source:"@site/guides/tutorials/mediation.md",sourceDirName:"tutorials",slug:"/tutorials/mediation",permalink:"/guides/tutorials/mediation",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Issue a credential",permalink:"/guides/tutorials/issue-a-credential"},next:{title:"Updating Credo",permalink:"/guides/updating/"}},l={},d=[{value:"What is a mediator, and Why should I use one?",id:"what-is-a-mediator-and-why-should-i-use-one",level:3},{value:"1. Mediator setup",id:"1-mediator-setup",level:3},{value:"2. Recipient (Alice) setup",id:"2-recipient-alice-setup",level:3},{value:"3. Message exchange",id:"3-message-exchange",level:3},{value:"Useful resources",id:"useful-resources",level:3}],u={toc:d},p="wrapper";function m(e){let{components:t,...a}=e;return(0,n.kt)(p,(0,i.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"mediation"},"Mediation"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"This section assumes that you have:"),(0,n.kt)("ol",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ol"},"Set up a ",(0,n.kt)("a",{parentName:"li",href:"../getting-started/installation"},"valid environment")," for development"),(0,n.kt)("li",{parentName:"ol"},"Basic knowledge of the required fields in the ",(0,n.kt)("a",{parentName:"li",href:"./agent-config"},"agent\nconfig"))),(0,n.kt)("p",{parentName:"blockquote"},"The agent setup varies depending on your target environment, React Native or Node.js.",(0,n.kt)("br",{parentName:"p"}),"\n","This tutorial assumes a Node.js environment for all agents (Alice, Bob, Meditator).")),(0,n.kt)("p",null,"This tutorial shows how to set up a mediator, how to configure an agent to use a mediator, and how agents exchange messages with a mediator in place.\nConcepts are explained in isolation:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/guides/tutorials/mediation#1-mediator-setup"},"First"),", it is shown how to set up a mediator."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/guides/tutorials/mediation#2-recipient-alice-setup"},"Second"),", it is demonstrated how to use a mediator."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/guides/tutorials/mediation#3-message-exchange"},"Third"),", the message exchange between agents with a mediator in place is explained.")),(0,n.kt)("h3",{id:"what-is-a-mediator-and-why-should-i-use-one"},"What is a mediator, and Why should I use one?"),(0,n.kt)("p",null,"A mediator is just a special type of agent."),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"\"When we describe agent-to-agent communication, it is convenient to think of an interaction only in terms of Alice and Bob and their agents. We say things like: \"Alice's agent sends a message to Bob's agent\" -- or perhaps \"Alice's edge agent sends a message to Bob's cloud agent, which forwards it to Bob's edge agent\"."),(0,n.kt)("p",{parentName:"admonition"},"Such statements adopt a useful level of abstraction--one that's highly recommended for most discussions. However, they make a number of simplifications. By modeling the roles of mediators and relays in routing, we can support routes that use multiple transports, routes that are not fully known (or knowable) to the sender, routes that pass through mix networks, and other advanced and powerful concepts.\"",(0,n.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-rfcs/blob/main/concepts/0046-mediators-and-relays/README.md#aries-rfc-0046-mediators-and-relays"},"Aries RFC 0046: Mediators and Relays"))),(0,n.kt)("p",null,'A practical example where the use of mediators is beneficial can be found in a mobile environment. A mobile agent, aka. your mobile wallet, receives messages from other agents. Technically, sending HTTP messages to a mobile agent is impossible because the agent does not have a public IP. As you have probably seen in previous examples, a workaround for this scenario is to use ngrok. Another option is to use a mediator. When an agent is configured to use a mediator, messages to that agent are routed through the mediator and from there to its destination. Thus, a mobile agent can use a "public" mediator to receive messages on its behalf and poll them from time to time.'),(0,n.kt)("p",null,"This is just one example of how a mediator can be used. Further resources about mediators can be found ",(0,n.kt)("a",{parentName:"p",href:"/guides/tutorials/mediation#useful-resources"},"here"),"."),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"With mediators, WebSockets come in handy. In a production environment, it is recommendable to register a ",(0,n.kt)("inlineCode",{parentName:"p"},"WsInboundTransport()")," for Alice and a ",(0,n.kt)("inlineCode",{parentName:"p"},"WsOutboundTransport()")," for the mediator. These WebSocket transports allow the mediator to push messages to Alice instead of having Alice pull messages from the mediator repeatedly.")),(0,n.kt)("h3",{id:"1-mediator-setup"},"1. Mediator setup"),(0,n.kt)("p",null,"The first part shows how to set up a mediator agent. Generally, there are two ways to do that: deploying it from scratch or using a third-party mediator. This section focuses on the former approach, setting up the mediator from scratch."),(0,n.kt)("p",null,"The mediator is set up on port 3001 and creates an Out-of-Band invitation that allows multiple other agents to connect to the mediator. Configuring an agent as a mediator demands utilizing the ",(0,n.kt)("inlineCode",{parentName:"p"},"MediatorModule"),". In this example, the ",(0,n.kt)("inlineCode",{parentName:"p"},"autoAcceptMediationRequests")," flag is set to true to accept mediation requests automatically."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"showLineNumbers mediator-setup.ts section-1",showLineNumbers:!0,"mediator-setup.ts":!0,"section-1":!0},"")),(0,n.kt)("h3",{id:"2-recipient-alice-setup"},"2. Recipient (Alice) setup"),(0,n.kt)("p",null,"The second part shows how to use a mediator. Becoming a recipient of a mediator requires using the ",(0,n.kt)("inlineCode",{parentName:"p"},"MediationRecipientModule"),". The setup is the same whether you use your own or a third-party mediator."),(0,n.kt)("p",null,"The easiest way to set everything up is by configuring the ",(0,n.kt)("inlineCode",{parentName:"p"},"MediationRecipientModule")," to connect to the mediator on agent startup. This can be done by constructing the module with the ",(0,n.kt)("inlineCode",{parentName:"p"},"mediatorInvitationUrl"),". You can get the mediatorInvitationUrl either from ",(0,n.kt)("a",{parentName:"p",href:"/guides/tutorials/mediation#1-mediator-setup"},"part one")," by running a mediator yourself or from a public mediator such as the Animo-mediator. The following snippet uses the latter approach."),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"ConnectionsModule")," used in this snippet serves the sole purpose of automatically accepting connections and thus simplifying setup."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"showLineNumbers mediation-recipient.ts section-1",showLineNumbers:!0,"mediation-recipient.ts":!0,"section-1":!0},"")),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"In case you are using a third-party mediator and cannot create an invitationUrl, it is common practice for mediators to provide an endpoint from which the invitationUrl can be fetched.")),(0,n.kt)("h3",{id:"3-message-exchange"},"3. Message exchange"),(0,n.kt)("p",null,"This section explains the message exchange between agents when a mediator is in place. The process is illustrated using the diagram below. Parts ",(0,n.kt)("a",{parentName:"p",href:"/guides/tutorials/mediation#1-mediator-setup"},"one")," and ",(0,n.kt)("a",{parentName:"p",href:"/guides/tutorials/mediation#2-recipient-alice-setup"},"two")," of this tutorial showed how to set up and use a mediator. If the ",(0,n.kt)("inlineCode",{parentName:"p"},"mediatorInvitationUrl")," is specified when constructing the ",(0,n.kt)("inlineCode",{parentName:"p"},"MediationRecipientModule")," (as in ",(0,n.kt)("a",{parentName:"p",href:"/guides/tutorials/mediation#2-recipient-alice-setup"},"Part two"),"), the mediation request and grant ",(0,n.kt)("em",{parentName:"p"},"(1-2)")," between Alice and the mediator will be performed automatically when Alice's agent is started."),(0,n.kt)("p",null,"If Alice establishes a connection with another fictional agent, say, Bob's agent, who is not using any mediators ",(0,n.kt)("em",{parentName:"p"},"(3-6)"),". (Connection establishment is no different when a mediator is involved). Then, messages from Alice to Bob ",(0,n.kt)("em",{parentName:"p"},"(7)")," are routed directly to Bob, while messages from Bob to Alice ",(0,n.kt)("em",{parentName:"p"},"(8-9)")," are routed through the intermediary."),(0,n.kt)("mermaid",{value:"sequenceDiagram\n    autonumber\n    participant Alice\n    participant Mediator\n    participant Bob\n    Note over Mediator: Start\n    Note over Alice: Start\n    Alice->>Mediator: Request Mediation\n    Mediator->>Alice: Grant Mediation\n    Note over Bob: Start\n    Alice->>Alice: CreateInvitation\n    Alice --\x3e Bob: (Send Invitation to Bob)\n    Bob->>Bob: RecieveInvitation\n    Alice->>Bob: WaitForConnection\n    Alice->>Bob: SendMessage Alice->Bob\n    Bob->>Mediator: SendMessage Bob->Alice (Mediator)\n    Mediator->>Alice: ForwardMessage Bob->Alice (Mediator)"}),(0,n.kt)("h3",{id:"useful-resources"},"Useful resources"),(0,n.kt)("p",null,"For more information about mediator refer to:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/hyperledger/aries-rfcs/tree/main/features/0211-route-coordination"},"Aries Mediator Coordination Protocol")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://indicio-tech.github.io/mediator"},"Indicio Public Mediator")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/animo/animo-mediator"},"Setup your own Credo Mediator")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/hyperledger/aries-rfcs/blob/main/concepts/0046-mediators-and-relays/README.md#aries-rfc-0046-mediators-and-relays"},"Aries RFC 0046: Mediators and Relays"))))}m.isMDXComponent=!0}}]);